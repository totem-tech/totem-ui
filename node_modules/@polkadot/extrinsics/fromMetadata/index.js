"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = fromMetadata;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _util = require("@polkadot/util");

var _ = _interopRequireDefault(require("../"));

var _createUnchecked = _interopRequireDefault(require("./createUnchecked"));

// Copyright 2017-2019 @polkadot/extrinsics authors & contributors
// This software may be modified and distributed under the terms
// of the Apache-2.0 license. See the LICENSE file for details.

/**
 * Extend a storage object with the storage modules & module functions present
 * in the metadata.
 *
 * @param extrinsics - An extrinsics object to be extended.
 * @param metadata - The metadata to extend the storage object against.
 */
function fromMetadata(metadata) {
  return metadata.asV5.modules.filter(modul => modul.calls.isSome).reduce((result, modul, sectionIndex) => {
    const section = (0, _util.stringCamelCase)(modul.name.toString());
    result[section] = modul.calls.unwrap().reduce((newModule, callMetadata, methodIndex) => {
      const method = (0, _util.stringCamelCase)(callMetadata.name.toString());
      newModule[method] = (0, _createUnchecked.default)(section, sectionIndex, methodIndex, callMetadata);
      return newModule;
    }, {});
    return result;
  }, (0, _objectSpread2.default)({}, _.default));
}